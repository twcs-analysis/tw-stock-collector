# è³‡æ–™é©—è­‰è¦ç¯„

æœ¬æ–‡ä»¶å®šç¾©å°è‚¡è³‡æ–™æ”¶é›†ç³»çµ±çš„è³‡æ–™å“è³ªé©—è­‰æ¨™æº–èˆ‡é©—è­‰æ–¹æ³•ã€‚

## ğŸ“‹ ç›®éŒ„

- [é©—è­‰å±¤ç´š](#é©—è­‰å±¤ç´š)
- [é©—è­‰é …ç›®](#é©—è­‰é …ç›®)
- [é©—è­‰æ¨™æº–](#é©—è­‰æ¨™æº–)
- [éš¨æ©ŸæŠ½æ¨£æ¯”å°æ©Ÿåˆ¶](#éš¨æ©ŸæŠ½æ¨£æ¯”å°æ©Ÿåˆ¶)
- [é©—è­‰å·¥å…·](#é©—è­‰å·¥å…·)

---

## ğŸ¯ é©—è­‰å±¤ç´š

è³‡æ–™é©—è­‰åˆ†ç‚ºä¸‰å€‹å±¤ç´šï¼š

### Level 1: åŸºæœ¬çµæ§‹é©—è­‰
**ç›®çš„**: ç¢ºä¿æª”æ¡ˆæ ¼å¼æ­£ç¢ºã€å¯è®€å–
**åŸ·è¡Œæ™‚æ©Ÿ**: æ¯æ¬¡è³‡æ–™æ”¶é›†å¾Œ
**é©—è­‰é …ç›®**:
- æª”æ¡ˆæ˜¯å¦å­˜åœ¨
- JSON æ ¼å¼æ˜¯å¦æ­£ç¢º
- æª”æ¡ˆå¤§å°æ˜¯å¦åˆç†

### Level 2: è³‡æ–™å®Œæ•´æ€§é©—è­‰
**ç›®çš„**: ç¢ºä¿è³‡æ–™å…§å®¹å®Œæ•´ã€æ¬„ä½é½Šå…¨
**åŸ·è¡Œæ™‚æ©Ÿ**: æ¯æ¬¡è³‡æ–™æ”¶é›†å¾Œ
**é©—è­‰é …ç›®**:
- metadata æ˜¯å¦å®Œæ•´
- å¿…è¦æ¬„ä½æ˜¯å¦å­˜åœ¨
- è³‡æ–™ç­†æ•¸æ˜¯å¦åˆç†

### Level 3: æ•¸å€¼åˆç†æ€§é©—è­‰
**ç›®çš„**: ç¢ºä¿è³‡æ–™æ•¸å€¼ç¬¦åˆå•†æ¥­é‚è¼¯
**åŸ·è¡Œæ™‚æ©Ÿ**: æ¯æ—¥å®šæœŸé©—è­‰ + å›è£œå¾Œé©—è­‰
**é©—è­‰é …ç›®**:
- æ•¸å€¼ç¯„åœæ˜¯å¦åˆç†
- æ•¸å€¼é‚è¼¯æ˜¯å¦æ­£ç¢º
- èˆ‡æ­·å²è³‡æ–™æ˜¯å¦ä¸€è‡´

---

## âœ… é©—è­‰é …ç›®

### 1. åŸºæœ¬çµæ§‹é©—è­‰

#### 1.1 æª”æ¡ˆå­˜åœ¨æ€§æª¢æŸ¥

```python
# æª¢æŸ¥é …ç›®
- æª”æ¡ˆè·¯å¾‘: data/raw/{type}/{YYYY}/{MM}/{YYYY-MM-DD}.json
- æª”æ¡ˆå¤§å°: æœ€å° 10KB, æœ€å¤§ 10MB

# é©—è­‰è¦å‰‡
PASS: æª”æ¡ˆå­˜åœ¨ä¸”å¤§å°åœ¨åˆç†ç¯„åœå…§
FAIL: æª”æ¡ˆä¸å­˜åœ¨æˆ–å¤§å°ç•°å¸¸
WARN: æª”æ¡ˆå¤§å°åé›¢å¹³å‡å€¼ Â±50%
```

#### 1.2 JSON æ ¼å¼é©—è­‰

```python
# æª¢æŸ¥é …ç›®
- æ˜¯å¦ç‚ºæœ‰æ•ˆ JSON
- æ˜¯å¦ç¬¦åˆé æœŸçµæ§‹ (metadata + data)

# é©—è­‰è¦å‰‡
PASS: JSON æ ¼å¼æ­£ç¢ºä¸”åŒ…å« metadata å’Œ data
FAIL: JSON æ ¼å¼éŒ¯èª¤æˆ–ç¼ºå°‘å¿…è¦æ¬„ä½
```

### 2. Metadata é©—è­‰

#### 2.1 å¿…è¦æ¬„ä½æª¢æŸ¥

```json
{
  "metadata": {
    "date": "YYYY-MM-DD",           // å¿…è¦ï¼Œæ ¼å¼æ­£ç¢º
    "collected_at": "YYYY-MM-DD HH:MM:SS", // å¿…è¦ï¼Œæ ¼å¼æ­£ç¢º
    "total_count": 1000,             // å¿…è¦ï¼Œæ­£æ•´æ•¸
    "source": "TWSE + TPEx Official API"    // å¿…è¦ï¼Œå­—ä¸²
  }
}
```

**é©—è­‰è¦å‰‡**:
- `date`: å¿…é ˆç¬¦åˆ `YYYY-MM-DD` æ ¼å¼
- `collected_at`: å¿…é ˆç¬¦åˆ `YYYY-MM-DD HH:MM:SS` æ ¼å¼
- `total_count`: å¿…é ˆç‚ºæ­£æ•´æ•¸ï¼Œç¯„åœ 500~3000
- `source`: å¿…é ˆåŒ…å« "TWSE" æˆ– "TPEx"

#### 2.2 æ—¥æœŸä¸€è‡´æ€§æª¢æŸ¥

```python
# æª¢æŸ¥é …ç›®
- æª”æ¡ˆåç¨±ä¸­çš„æ—¥æœŸ = metadata.date
- metadata.collected_at >= metadata.date

# é©—è­‰è¦å‰‡
PASS: æ—¥æœŸä¸€è‡´
FAIL: æ—¥æœŸä¸ä¸€è‡´
```

### 3. è³‡æ–™å®Œæ•´æ€§é©—è­‰

#### 3.1 è³‡æ–™ç­†æ•¸æª¢æŸ¥

| è³‡æ–™é¡å‹ | ä¸­æ–‡åç¨± | æœ€å°ç­†æ•¸ | é æœŸç­†æ•¸ | æœ€å¤§ç­†æ•¸ |
|---------|---------|---------|---------|---------|
| price | åƒ¹æ ¼è³‡æ–™ | 1,500 | 1,946 | 2,500 |
| institutional | ä¸‰å¤§æ³•äºº | 800 | 1,027 | 1,500 |
| margin | èè³‡èåˆ¸ | 1,500 | 1,815 | 2,500 |
| lending | å€Ÿåˆ¸è³£å‡º | 800 | 1,046 | 1,500 |

**é©—è­‰è¦å‰‡**:
- `PASS`: ç­†æ•¸åœ¨æœ€å°~æœ€å¤§ç¯„åœå…§
- `WARN`: ç­†æ•¸åœ¨ç¯„åœå…§ä½†åé›¢é æœŸå€¼ Â±20%
- `FAIL`: ç­†æ•¸å°æ–¼æœ€å°å€¼æˆ–å¤§æ–¼æœ€å¤§å€¼

#### 3.2 å¿…è¦æ¬„ä½æª¢æŸ¥

##### Price (åƒ¹æ ¼è³‡æ–™)
```python
required_fields = [
    'date',          # æ—¥æœŸ
    'stock_id',      # è‚¡ç¥¨ä»£ç¢¼
    'stock_name',    # è‚¡ç¥¨åç¨±
    'open',          # é–‹ç›¤åƒ¹
    'high',          # æœ€é«˜åƒ¹
    'low',           # æœ€ä½åƒ¹
    'close',         # æ”¶ç›¤åƒ¹
    'volume',        # æˆäº¤é‡
    'type'           # å¸‚å ´é¡å‹ (twse/tpex)
]

# é©—è­‰è¦å‰‡
- æ‰€æœ‰æ¬„ä½å¿…é ˆå­˜åœ¨
- å…è¨±ç©ºå€¼çš„æ¬„ä½: ç„¡ï¼ˆæ‰€æœ‰æ¬„ä½éƒ½å¿…é ˆæœ‰å€¼ï¼‰
- è³‡æ–™å‹æ…‹å¿…é ˆæ­£ç¢º
```

##### Institutional (ä¸‰å¤§æ³•äºº)
```python
required_fields = [
    'date',                    # æ—¥æœŸ
    'stock_id',                # è‚¡ç¥¨ä»£ç¢¼
    'stock_name',              # è‚¡ç¥¨åç¨±
    'foreign_buy',             # å¤–è³‡è²·é€²
    'foreign_sell',            # å¤–è³‡è³£å‡º
    'foreign_net',             # å¤–è³‡è²·è³£è¶…
    'trust_buy',               # æŠ•ä¿¡è²·é€²
    'trust_sell',              # æŠ•ä¿¡è³£å‡º
    'trust_net',               # æŠ•ä¿¡è²·è³£è¶…
    'dealer_buy',              # è‡ªç‡Ÿå•†è²·é€²
    'dealer_sell',             # è‡ªç‡Ÿå•†è³£å‡º
    'dealer_net',              # è‡ªç‡Ÿå•†è²·è³£è¶…
    'total_net',               # ä¸‰å¤§æ³•äººè²·è³£è¶…åˆè¨ˆ
    'type'                     # å¸‚å ´é¡å‹
]
```

##### Margin (èè³‡èåˆ¸)
```python
required_fields = [
    'date',                    # æ—¥æœŸ
    'stock_id',                # è‚¡ç¥¨ä»£ç¢¼
    'stock_name',              # è‚¡ç¥¨åç¨±
    'margin_balance',          # èè³‡é¤˜é¡
    'margin_change',           # èè³‡å¢æ¸›
    'short_balance',           # èåˆ¸é¤˜é¡
    'short_change',            # èåˆ¸å¢æ¸›
    'type'                     # å¸‚å ´é¡å‹
]
```

##### Lending (å€Ÿåˆ¸è³£å‡º)
```python
required_fields = [
    'date',                    # æ—¥æœŸ
    'stock_id',                # è‚¡ç¥¨ä»£ç¢¼
    'stock_name',              # è‚¡ç¥¨åç¨±
    'lending_balance',         # å€Ÿåˆ¸é¤˜é¡
    'lending_change',          # å€Ÿåˆ¸å¢æ¸›
    'type'                     # å¸‚å ´é¡å‹
]
```

#### 3.3 ç©ºå€¼æª¢æŸ¥

```python
# æª¢æŸ¥é …ç›®
- å¿…è¦æ¬„ä½ä¸å¾—ç‚º nullã€ç©ºå­—ä¸²ã€NaN

# é©—è­‰è¦å‰‡
PASS: æ‰€æœ‰å¿…è¦æ¬„ä½éƒ½æœ‰å€¼
WARN: éå¿…è¦æ¬„ä½æœ‰ç©ºå€¼ï¼ˆè¨˜éŒ„ä½†ä¸å½±éŸ¿ï¼‰
FAIL: å¿…è¦æ¬„ä½æœ‰ç©ºå€¼
```

### 4. æ•¸å€¼åˆç†æ€§é©—è­‰

#### 4.1 åƒ¹æ ¼è³‡æ–™é©—è­‰

```python
# åƒ¹æ ¼ç¯„åœ
price_ranges = {
    'open':   (0.01, 10000),    # é–‹ç›¤åƒ¹
    'high':   (0.01, 10000),    # æœ€é«˜åƒ¹
    'low':    (0.01, 10000),    # æœ€ä½åƒ¹
    'close':  (0.01, 10000),    # æ”¶ç›¤åƒ¹
    'volume': (0, 1000000000)   # æˆäº¤é‡
}

# åƒ¹æ ¼é‚è¼¯
validation_rules = {
    'high_low': 'high >= low',           # æœ€é«˜åƒ¹ >= æœ€ä½åƒ¹
    'high_open': 'high >= open',         # æœ€é«˜åƒ¹ >= é–‹ç›¤åƒ¹
    'high_close': 'high >= close',       # æœ€é«˜åƒ¹ >= æ”¶ç›¤åƒ¹
    'low_open': 'low <= open',           # æœ€ä½åƒ¹ <= é–‹ç›¤åƒ¹
    'low_close': 'low <= close',         # æœ€ä½åƒ¹ <= æ”¶ç›¤åƒ¹
    'volume_positive': 'volume >= 0'     # æˆäº¤é‡ >= 0
}

# ç•°å¸¸å€¼æª¢æ¸¬
- æ¼²è·Œå¹…è¶…é Â±20% éœ€æ¨™è¨˜
- æˆäº¤é‡ç‚º 0 éœ€æ¨™è¨˜ï¼ˆå¯èƒ½åœç‰Œï¼‰
```

#### 4.2 æ³•äººè³‡æ–™é©—è­‰

```python
# æ•¸å€¼ç¯„åœ
institutional_ranges = {
    'buy':  (-1e12, 1e12),     # è²·é€²é‡‘é¡
    'sell': (-1e12, 1e12),     # è³£å‡ºé‡‘é¡
    'net':  (-1e12, 1e12)      # è²·è³£è¶…
}

# é‚è¼¯é©—è­‰
validation_rules = {
    'net_calculation': 'net = buy - sell',  # è²·è³£è¶… = è²·é€² - è³£å‡º
    'total_sum': 'total_net = foreign_net + trust_net + dealer_net'
}

# ç•°å¸¸å€¼æª¢æ¸¬
- å–®æ—¥è²·è³£è¶…è¶…é 10 å„„éœ€æ¨™è¨˜
```

#### 4.3 èè³‡èåˆ¸é©—è­‰

```python
# æ•¸å€¼ç¯„åœ
margin_ranges = {
    'balance': (0, 1e12),      # é¤˜é¡å¿…é ˆ >= 0
    'change':  (-1e12, 1e12)   # å¢æ¸›å¯æ­£å¯è² 
}

# ç•°å¸¸å€¼æª¢æ¸¬
- å–®æ—¥å¢æ¸›è¶…é Â±50% éœ€æ¨™è¨˜
- é¤˜é¡çªç„¶æ­¸é›¶éœ€æ¨™è¨˜
```

### 5. è·¨æ—¥è³‡æ–™ä¸€è‡´æ€§é©—è­‰

#### 5.1 é¤˜é¡é€£çºŒæ€§æª¢æŸ¥

```python
# æª¢æŸ¥é‚è¼¯ï¼ˆä»¥èè³‡ç‚ºä¾‹ï¼‰
today_balance = today.margin_balance
yesterday_balance = yesterday.margin_balance
today_change = today.margin_change

# é©—è­‰è¦å‰‡
expected_balance = yesterday_balance + today_change
tolerance = 1000  # å…è¨±èª¤å·®

if abs(today_balance - expected_balance) > tolerance:
    status = WARN  # å¯èƒ½æœ‰é™¤æ¬Šæ¯æˆ–å…¶ä»–å› ç´ 
```

#### 5.2 æ­·å²è³‡æ–™æ¯”å°

```python
# æª¢æŸ¥é …ç›®
- åŒä¸€è‚¡ç¥¨åœ¨ä¸åŒæ—¥æœŸçš„è³‡æ–™æ˜¯å¦å­˜åœ¨ç•°å¸¸è·³å‹•
- åƒ¹æ ¼çªç„¶æš´æ¼²æš´è·Œï¼ˆÂ±50%ï¼‰
- æˆäº¤é‡çªç„¶æš´å¢ï¼ˆè¶…éå¹³å‡å€¼ 10 å€ï¼‰

# é©—è­‰è¦å‰‡
PASS: æ³¢å‹•åœ¨åˆç†ç¯„åœå…§
WARN: æ³¢å‹•è¼ƒå¤§ä½†å¯èƒ½æ­£å¸¸ï¼ˆé™¤æ¬Šæ¯ã€é‡å¤§äº‹ä»¶ï¼‰
FAIL: æ³¢å‹•è¶…å‡ºåˆç†ç¯„åœï¼Œéœ€äººå·¥ç¢ºèª
```

---

## ğŸ² éš¨æ©ŸæŠ½æ¨£æ¯”å°æ©Ÿåˆ¶

### è¨­è¨ˆåŸå‰‡

1. **åˆ†å±¤æŠ½æ¨£**: ä¾å¸‚å ´é¡å‹ï¼ˆä¸Šå¸‚/ä¸Šæ«ƒï¼‰å’Œç”¢æ¥­åˆ†é¡é€²è¡Œåˆ†å±¤
2. **éš¨æ©Ÿæ€§**: ä½¿ç”¨å½éš¨æ©Ÿæ•¸ç”Ÿæˆå™¨ç¢ºä¿å¯é‡ç¾æ€§
3. **è¦†è“‹ç‡**: ç¢ºä¿å„é¡å‹è‚¡ç¥¨éƒ½è¢«æŠ½æ¨£åˆ°
4. **æ¯”å°é »ç‡**: æ¯æ—¥è‡ªå‹•æ¯”å° + äººå·¥è§¸ç™¼æ¯”å°

### æŠ½æ¨£ç­–ç•¥

#### ç­–ç•¥ 1: å›ºå®šæ•¸é‡æŠ½æ¨£

```python
# æ¯æ—¥æŠ½æ¨£é…é¡
daily_sample_size = {
    'price': 20,          # æŠ½æ¨£ 20 æª”è‚¡ç¥¨
    'institutional': 15,  # æŠ½æ¨£ 15 æª”è‚¡ç¥¨
    'margin': 15,         # æŠ½æ¨£ 15 æª”è‚¡ç¥¨
    'lending': 10         # æŠ½æ¨£ 10 æª”è‚¡ç¥¨
}

# æŠ½æ¨£åˆ†å¸ƒ
sample_distribution = {
    'twse': 0.6,  # 60% ä¸Šå¸‚è‚¡ç¥¨
    'tpex': 0.4   # 40% ä¸Šæ«ƒè‚¡ç¥¨
}

# æŠ½æ¨£æ¬Šé‡ï¼ˆå„ªå…ˆæŠ½æ¨£é‡è¦è‚¡ç¥¨ï¼‰
sample_weights = {
    'large_cap': 0.5,    # 50% å¤§å‹è‚¡ï¼ˆå¸‚å€¼å‰ 100ï¼‰
    'mid_cap': 0.3,      # 30% ä¸­å‹è‚¡
    'small_cap': 0.2     # 20% å°å‹è‚¡
}
```

#### ç­–ç•¥ 2: åˆ†å±¤éš¨æ©ŸæŠ½æ¨£

```python
# ç¬¬ä¸€å±¤: å¸‚å ´é¡å‹
markets = ['twse', 'tpex']

# ç¬¬äºŒå±¤: ç”¢æ¥­åˆ†é¡
industries = [
    'åŠå°é«”æ¥­', 'é›»è…¦åŠé€±é‚Šè¨­å‚™æ¥­', 'å…‰é›»æ¥­',
    'é€šä¿¡ç¶²è·¯æ¥­', 'é‡‘èä¿éšªæ¥­', 'èˆªé‹æ¥­'
]

# æŠ½æ¨£æ–¹æ³•
def stratified_sampling(data, n_samples=20):
    """
    åˆ†å±¤æŠ½æ¨£

    1. ä¾å¸‚å ´é¡å‹åˆ†çµ„
    2. ä¾ç”¢æ¥­åˆ†é¡åˆ†çµ„
    3. æ¯å€‹ç¾¤çµ„æŠ½æ¨£ ceiling(n_samples / n_groups)
    4. ç¢ºä¿è‡³å°‘æ¯å€‹ç¾¤çµ„æœ‰ 1 å€‹æ¨£æœ¬
    """
    samples = []

    # å¸‚å ´åˆ†å±¤
    for market in markets:
        market_data = data[data['type'] == market]

        # ç”¢æ¥­åˆ†å±¤
        for industry in industries:
            industry_data = market_data[
                market_data['industry'] == industry
            ]

            if len(industry_data) > 0:
                # éš¨æ©ŸæŠ½ 1~2 æª”
                n = min(2, len(industry_data))
                sample = industry_data.sample(n=n, random_state=seed)
                samples.append(sample)

    return pd.concat(samples).head(n_samples)
```

#### ç­–ç•¥ 3: æŒ‡æ¨™è‚¡ç¥¨å¿…æŠ½

```python
# å¿…æŠ½è‚¡ç¥¨æ¸…å–®ï¼ˆæŒ‡æ¨™è‚¡ï¼‰
must_check_stocks = [
    '2330',  # å°ç©é›»
    '2317',  # é´»æµ·
    '2454',  # è¯ç™¼ç§‘
    '2412',  # ä¸­è¯é›»
    '2882',  # åœ‹æ³°é‡‘
    '2891',  # ä¸­ä¿¡é‡‘
    '2303',  # è¯é›»
    '2308',  # å°é”é›»
    '1301',  # å°å¡‘
    '1303'   # å—äº
]

# æŠ½æ¨£é‚è¼¯
def smart_sampling(data, n_samples=20):
    """
    æ™ºèƒ½æŠ½æ¨£

    1. å¿…æŠ½è‚¡ç¥¨: 10 æª”æŒ‡æ¨™è‚¡ï¼ˆå›ºå®šï¼‰
    2. éš¨æ©ŸæŠ½æ¨£: 10 æª”ä¸€èˆ¬è‚¡ç¥¨ï¼ˆéš¨æ©Ÿï¼‰
    """
    # å¿…æŠ½æ¨£æœ¬
    must_samples = data[data['stock_id'].isin(must_check_stocks)]

    # éš¨æ©Ÿæ¨£æœ¬
    remaining_data = data[~data['stock_id'].isin(must_check_stocks)]
    random_samples = remaining_data.sample(
        n=n_samples - len(must_samples),
        random_state=seed
    )

    return pd.concat([must_samples, random_samples])
```

### æ¯”å°æ–¹æ³•

#### æ–¹æ³• 1: ç›´æ¥æ¯”å°å®˜ç¶²è³‡æ–™

```python
# æ¯”å°æµç¨‹
1. å¾æŠ½æ¨£æ¸…å–®ä¸­é¸å–è‚¡ç¥¨
2. å‘¼å« TWSE/TPEx API ç²å–å®˜æ–¹è³‡æ–™
3. æ¯”å°æ”¶é›†çš„è³‡æ–™èˆ‡å®˜æ–¹è³‡æ–™
4. è¨ˆç®—å·®ç•°ä¸¦è©•åˆ†

# æ¯”å°é …ç›®
- åƒ¹æ ¼è³‡æ–™: open, high, low, close, volume
- æ³•äººè³‡æ–™: foreign_net, trust_net, dealer_net
- èè³‡èåˆ¸: margin_balance, short_balance
- å€Ÿåˆ¸è³£å‡º: lending_balance

# å®¹å·®è¨­å®š
tolerance = {
    'price': 0.01,      # åƒ¹æ ¼å…è¨± 0.01 å…ƒèª¤å·®
    'volume': 1000,     # æˆäº¤é‡å…è¨± 1000 è‚¡èª¤å·®
    'amount': 10000     # é‡‘é¡å…è¨± 1 è¬å…ƒèª¤å·®
}
```

#### æ–¹æ³• 2: äº¤å‰é©—è­‰

```python
# é©—è­‰é‚è¼¯
1. å¾å…©å€‹ä¸åŒä¾†æºæ”¶é›†åŒä¸€å¤©çš„è³‡æ–™
2. æ¯”å°å…©ä»½è³‡æ–™æ˜¯å¦ä¸€è‡´
3. å¦‚æœ‰å·®ç•°ï¼Œä»¥å®˜ç¶²ç‚ºæº–

# è³‡æ–™ä¾†æº
source_a = "TWSE/TPEx Official API"
source_b = "FinMind API"  # è¼”åŠ©é©—è­‰

# ä¸€è‡´æ€§è©•åˆ†
consistency_score = (matched_count / total_count) * 100
```

#### æ–¹æ³• 3: é‚è¼¯é©—è­‰

```python
# é©—è­‰é …ç›®
1. ç•¶æ—¥æˆäº¤é‡åŠ ç¸½ = metadata.total_volumeï¼ˆå¦‚æœ‰æä¾›ï¼‰
2. ä¸‰å¤§æ³•äººè²·è³£è¶…åˆè¨ˆ = foreign + trust + dealer
3. é¤˜é¡ = å‰æ—¥é¤˜é¡ + ç•¶æ—¥å¢æ¸›

# é©—è­‰çµæœ
PASS: æ‰€æœ‰é‚è¼¯é©—è­‰é€šé
WARN: éƒ¨åˆ†é©—è­‰æœªé€šéä½†å¯æ¥å—
FAIL: é—œéµé©—è­‰æœªé€šé
```

### æ¯”å°å ±å‘Š

```python
# å ±å‘Šæ ¼å¼
validation_report = {
    'date': '2025-12-28',
    'data_type': 'price',
    'sample_size': 20,
    'validation_results': {
        'total_samples': 20,
        'passed': 18,
        'warned': 2,
        'failed': 0,
        'accuracy': 90.0  # (passed / total) * 100
    },
    'failed_stocks': [],
    'warned_stocks': [
        {
            'stock_id': '2330',
            'field': 'volume',
            'our_value': 45000000,
            'official_value': 45123000,
            'diff': 123000,
            'diff_pct': 0.27
        }
    ]
}
```

---

## ğŸ”§ é©—è­‰å·¥å…·

### å‘½ä»¤è¡Œå·¥å…·

```bash
# é©—è­‰å–®ä¸€æª”æ¡ˆ
python scripts/validate_data.py --file data/raw/price/2025/12/2025-12-28.json

# é©—è­‰æŒ‡å®šæ—¥æœŸ
python scripts/validate_data.py --date 2025-12-28 --type price

# é©—è­‰æ—¥æœŸç¯„åœ
python scripts/validate_data.py --start 2025-12-01 --end 2025-12-31

# éš¨æ©ŸæŠ½æ¨£æ¯”å°
python scripts/validate_data.py --date 2025-12-28 --sample 20 --compare-official

# ç”Ÿæˆé©—è­‰å ±å‘Š
python scripts/validate_data.py --date 2025-12-28 --report validation_report.html
```

### GitHub Actions è‡ªå‹•é©—è­‰

```yaml
# .github/workflows/data-validation.yml
name: Data Validation

on:
  schedule:
    - cron: '0 19 * * 1-5'  # æ¯äº¤æ˜“æ—¥ 19:00 åŸ·è¡Œ
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Validate daily data
        run: |
          python scripts/validate_data.py \
            --date $(date +%Y-%m-%d) \
            --sample 20 \
            --report
```

---

## ğŸ“Š å“è³ªæŒ‡æ¨™

### KPI å®šç¾©

| æŒ‡æ¨™ | ç›®æ¨™å€¼ | è­¦æˆ’å€¼ | èªªæ˜ |
|------|--------|--------|------|
| **è³‡æ–™å®Œæ•´ç‡** | â‰¥ 99% | < 95% | å¿…è¦æ¬„ä½çš„å®Œæ•´ç¨‹åº¦ |
| **æ ¼å¼æ­£ç¢ºç‡** | 100% | < 100% | JSON æ ¼å¼èˆ‡çµæ§‹æ­£ç¢ºæ€§ |
| **æ•¸å€¼æº–ç¢ºç‡** | â‰¥ 99.5% | < 98% | èˆ‡å®˜æ–¹è³‡æ–™æ¯”å°çš„æº–ç¢ºåº¦ |
| **é‚è¼¯ä¸€è‡´ç‡** | â‰¥ 99% | < 95% | è³‡æ–™é‚è¼¯é©—è­‰é€šéç‡ |
| **æ¯æ—¥é©—è­‰è¦†è“‹ç‡** | â‰¥ 1% | < 0.5% | æ¯æ—¥æŠ½æ¨£é©—è­‰çš„è‚¡ç¥¨æ¯”ä¾‹ |

### å“è³ªè©•ç´š

```python
# ç¶œåˆè©•åˆ†è¨ˆç®—
quality_score = (
    completeness * 0.3 +    # å®Œæ•´ç‡ 30%
    format_correct * 0.2 +   # æ ¼å¼æ­£ç¢ºç‡ 20%
    accuracy * 0.3 +         # æº–ç¢ºç‡ 30%
    consistency * 0.2        # ä¸€è‡´ç‡ 20%
)

# è©•ç´šæ¨™æº–
A+ : quality_score >= 99.0  # å„ªç§€
A  : quality_score >= 95.0  # è‰¯å¥½
B  : quality_score >= 90.0  # åˆæ ¼
C  : quality_score >= 80.0  # éœ€æ”¹é€²
D  : quality_score < 80.0   # ä¸åˆæ ¼
```

---

## ğŸš¨ ç•°å¸¸è™•ç†

### ç•°å¸¸åˆ†é¡

#### è¼•å¾®ç•°å¸¸ (WARN)
- è³‡æ–™ç­†æ•¸åé›¢é æœŸ Â±10%
- å€‹åˆ¥è‚¡ç¥¨åƒ¹æ ¼æ³¢å‹•è¼ƒå¤§ï¼ˆÂ±10%~20%ï¼‰
- æˆäº¤é‡ç‚º 0ï¼ˆå¯èƒ½åœç‰Œï¼‰

**è™•ç†æ–¹å¼**: è¨˜éŒ„æ—¥èªŒï¼Œä¸å½±éŸ¿å¾ŒçºŒæµç¨‹

#### ä¸­åº¦ç•°å¸¸ (ERROR)
- è³‡æ–™ç­†æ•¸åé›¢é æœŸ Â±20%
- å¿…è¦æ¬„ä½æœ‰ç©ºå€¼ï¼ˆ< 5% è³‡æ–™ï¼‰
- åƒ¹æ ¼é‚è¼¯éŒ¯èª¤ï¼ˆå¦‚ high < lowï¼‰

**è™•ç†æ–¹å¼**: ç™¼é€è­¦å‘Šé€šçŸ¥ï¼Œæ¨™è¨˜å•é¡Œè³‡æ–™

#### åš´é‡ç•°å¸¸ (CRITICAL)
- æª”æ¡ˆä¸å­˜åœ¨æˆ–ç„¡æ³•è®€å–
- JSON æ ¼å¼éŒ¯èª¤
- è³‡æ–™ç­†æ•¸ < æœ€å°å€¼
- å¿…è¦æ¬„ä½å¤§é‡ç©ºå€¼ï¼ˆ> 5%ï¼‰

**è™•ç†æ–¹å¼**: ç™¼é€ç·Šæ€¥é€šçŸ¥ï¼Œåœæ­¢å¾ŒçºŒæµç¨‹ï¼Œéœ€äººå·¥ä»‹å…¥

### ä¿®å¾©æ©Ÿåˆ¶

```python
# è‡ªå‹•ä¿®å¾©ï¼ˆåƒ…é™è¼•å¾®ç•°å¸¸ï¼‰
auto_fix_rules = {
    'trim_whitespace': True,     # ç§»é™¤å‰å¾Œç©ºç™½
    'fill_zero_volume': True,    # æˆäº¤é‡ç©ºå€¼å¡« 0
    'infer_missing_type': True   # å¾è‚¡ç¥¨ä»£ç¢¼æ¨æ–·å¸‚å ´é¡å‹
}

# äººå·¥ä¿®å¾©ï¼ˆä¸­åº¦ä»¥ä¸Šç•°å¸¸ï¼‰
manual_fix_required = {
    'price_logic_error': True,   # åƒ¹æ ¼é‚è¼¯éŒ¯èª¤
    'missing_required_field': True,  # ç¼ºå°‘å¿…è¦æ¬„ä½
    'file_corruption': True      # æª”æ¡ˆæå£
}
```

---

## ğŸ“ é©—è­‰ç´€éŒ„

### æ—¥èªŒæ ¼å¼

```json
{
  "timestamp": "2025-12-28T19:00:00",
  "validation_type": "daily",
  "date": "2025-12-28",
  "data_types": ["price", "institutional", "margin", "lending"],
  "summary": {
    "total_files": 4,
    "passed": 4,
    "warned": 0,
    "failed": 0
  },
  "details": [
    {
      "data_type": "price",
      "file_path": "data/raw/price/2025/12/2025-12-28.json",
      "validations": {
        "structure": "PASS",
        "metadata": "PASS",
        "completeness": "PASS",
        "values": "PASS",
        "sampling": {
          "sample_size": 20,
          "matched": 20,
          "accuracy": 100.0
        }
      }
    }
  ]
}
```

### å ±å‘Šå„²å­˜

```bash
# é©—è­‰å ±å‘Šç›®éŒ„çµæ§‹
logs/validation/
â”œâ”€â”€ daily/
â”‚   â”œâ”€â”€ 2025-12-28_validation.json
â”‚   â””â”€â”€ 2025-12-28_validation.html
â”œâ”€â”€ weekly/
â”‚   â””â”€â”€ 2025-W52_summary.json
â””â”€â”€ monthly/
    â””â”€â”€ 2025-12_summary.json
```

---

## ğŸ”„ æŒçºŒæ”¹é€²

### å®šæœŸæª¢è¦–

- **æ¯æ—¥**: æŸ¥çœ‹é©—è­‰å ±å‘Šï¼Œè™•ç†ç•°å¸¸
- **æ¯é€±**: çµ±è¨ˆé©—è­‰æŒ‡æ¨™ï¼Œåˆ†æè¶¨å‹¢
- **æ¯æœˆ**: è©•ä¼°é©—è­‰è¦å‰‡ï¼Œèª¿æ•´æ¨™æº–
- **æ¯å­£**: æª¢è¨é©—è­‰æ©Ÿåˆ¶ï¼Œå„ªåŒ–æµç¨‹

### ç‰ˆæœ¬æ§åˆ¶

```markdown
## ç‰ˆæœ¬æ­·å²

### v1.0.0 (2025-12-28)
- åˆç‰ˆç™¼å¸ƒ
- å®šç¾©åŸºæœ¬é©—è­‰è¦å‰‡
- å¯¦ä½œéš¨æ©ŸæŠ½æ¨£æ©Ÿåˆ¶

### v1.1.0 (è¨ˆç•«ä¸­)
- å¢åŠ äº¤å‰é©—è­‰
- å„ªåŒ–æŠ½æ¨£ç­–ç•¥
- åŠ å¼·ç•°å¸¸æª¢æ¸¬
```

---

## ğŸ“‹ é©—è­‰å ±å‘Šæ ¼å¼è¦ç¯„

### å ±å‘Šæª”æ¡ˆå‘½å

```
data/raw/{type}/{YYYY}/{MM}/{YYYY-MM-DD}-report.md
```

**ç¯„ä¾‹**:
- `data/raw/price/2025/12/2025-12-28-report.md`
- `data/raw/institutional/2025/12/2025-12-28-report.md`

### å ±å‘Šå…§å®¹æ ¼å¼

```markdown
# è³‡æ–™é©—è­‰å ±å‘Š

**è³‡æ–™é¡å‹**: {type_name}
**æ—¥æœŸ**: {date}
**é©—è­‰æ™‚é–“**: {validation_timestamp}
**è³‡æ–™æª”æ¡ˆ**: {file_path}

---

## ğŸ“Š é©—è­‰æ‘˜è¦

| é©—è­‰é …ç›® | çµæœ | å‚™è¨» |
|---------|------|------|
| æª”æ¡ˆå­˜åœ¨æ€§ | âœ… PASS | - |
| JSON æ ¼å¼ | âœ… PASS | - |
| è³‡æ–™ç­†æ•¸ | âœ… PASS | 1,946 ç­† (ç¯„åœ: 1,500~2,500) |
| å¿…è¦æ¬„ä½ | âœ… PASS | æ‰€æœ‰æ¬„ä½å®Œæ•´ |
| æ•¸å€¼ç¯„åœ | âš ï¸ WARN | 2 ç­†è³‡æ–™è¶…å‡ºé æœŸç¯„åœ |
| é‚è¼¯ä¸€è‡´æ€§ | âœ… PASS | - |

**ç¸½é«”è©•åˆ†**: A (95.0%)

---

## ğŸ“ˆ è³‡æ–™çµ±è¨ˆ

- **ç¸½ç­†æ•¸**: 1,946
- **ä¸Šå¸‚è‚¡ç¥¨**: 1,168 (60.0%)
- **ä¸Šæ«ƒè‚¡ç¥¨**: 778 (40.0%)
- **è³‡æ–™å¤§å°**: 612 KB

---

## ğŸ” è©³ç´°é©—è­‰çµæœ

### 1. çµæ§‹é©—è­‰

#### 1.1 æª”æ¡ˆæ ¼å¼æª¢æŸ¥
- âœ… æª”æ¡ˆå­˜åœ¨
- âœ… å¯æ­£å¸¸è®€å–
- âœ… JSON æ ¼å¼æœ‰æ•ˆ

#### 1.2 Metadata é©—è­‰
```json
{
  "date": "2025-12-28",
  "collected_at": "2025-12-28T18:30:45",
  "total_count": 1946,
  "source": "TWSE + TPEx Official API"
}
```
- âœ… date æ ¼å¼æ­£ç¢º
- âœ… collected_at æ ¼å¼æ­£ç¢º
- âœ… total_count èˆ‡å¯¦éš›ç­†æ•¸ä¸€è‡´
- âœ… source æ¬„ä½å­˜åœ¨

### 2. å®Œæ•´æ€§é©—è­‰

#### 2.1 è³‡æ–™ç­†æ•¸æª¢æŸ¥
- **å¯¦éš›ç­†æ•¸**: 1,946
- **é æœŸç¯„åœ**: 1,500 ~ 2,500
- **é æœŸå€¼**: 1,946
- **ç‹€æ…‹**: âœ… PASS

#### 2.2 å¿…è¦æ¬„ä½æª¢æŸ¥
- âœ… date: 1,946/1,946 (100%)
- âœ… stock_id: 1,946/1,946 (100%)
- âœ… stock_name: 1,946/1,946 (100%)
- âœ… open: 1,946/1,946 (100%)
- âœ… high: 1,946/1,946 (100%)
- âœ… low: 1,946/1,946 (100%)
- âœ… close: 1,946/1,946 (100%)
- âœ… volume: 1,946/1,946 (100%)

### 3. åˆç†æ€§é©—è­‰

#### 3.1 æ•¸å€¼ç¯„åœæª¢æŸ¥
- âœ… åƒ¹æ ¼ç¯„åœ: 0.01 ~ 10,000 (1,944/1,946 = 99.9%)
- âš ï¸ è¶…å‡ºç¯„åœ:
  - 2330: close = 10,500 (è¶…éä¸Šé™ 10,000)
  - 2454: close = 12,000 (è¶…éä¸Šé™ 10,000)

#### 3.2 é‚è¼¯ä¸€è‡´æ€§æª¢æŸ¥
- âœ… high >= low: 1,946/1,946 (100%)
- âœ… high >= open: 1,946/1,946 (100%)
- âœ… high >= close: 1,946/1,946 (100%)
- âœ… low <= open: 1,946/1,946 (100%)
- âœ… low <= close: 1,946/1,946 (100%)
- âœ… volume >= 0: 1,946/1,946 (100%)

---

## âš ï¸ è­¦å‘Šèˆ‡ç•°å¸¸

### æ•¸å€¼è¶…å‡ºé æœŸç¯„åœ (2 ç­†)

#### 1. è‚¡ç¥¨ä»£ç¢¼: 2330 (å°ç©é›»)
- **æ¬„ä½**: close
- **æ•¸å€¼**: 10,500
- **é æœŸç¯„åœ**: 0.01 ~ 10,000
- **è¶…å‡º**: 500 (+5.0%)
- **èªªæ˜**: é«˜åƒ¹è‚¡æ­£å¸¸ç¾è±¡ï¼Œå»ºè­°èª¿æ•´åƒ¹æ ¼ä¸Šé™

#### 2. è‚¡ç¥¨ä»£ç¢¼: 2454 (è¯ç™¼ç§‘)
- **æ¬„ä½**: close
- **æ•¸å€¼**: 12,000
- **é æœŸç¯„åœ**: 0.01 ~ 10,000
- **è¶…å‡º**: 2,000 (+20.0%)
- **èªªæ˜**: é«˜åƒ¹è‚¡æ­£å¸¸ç¾è±¡ï¼Œå»ºè­°èª¿æ•´åƒ¹æ ¼ä¸Šé™

---

## ğŸ¯ éš¨æ©ŸæŠ½æ¨£é©—è­‰ (é¸ç”¨)

**æŠ½æ¨£æ•¸é‡**: 20
**æŠ½æ¨£ç­–ç•¥**: åˆ†å±¤éš¨æ©ŸæŠ½æ¨£ + æŒ‡æ¨™è‚¡ç¥¨å¿…æŠ½

### æŠ½æ¨£æ¸…å–®
1. 2330 (å°ç©é›») - å¿…æŠ½
2. 2317 (é´»æµ·) - å¿…æŠ½
3. 2454 (è¯ç™¼ç§‘) - å¿…æŠ½
4. 1234 (éš¨æ©Ÿè‚¡ç¥¨A) - éš¨æ©Ÿ
5. 5678 (éš¨æ©Ÿè‚¡ç¥¨B) - éš¨æ©Ÿ
... (å…± 20 ç­†)

### èˆ‡å®˜æ–¹è³‡æ–™æ¯”å°çµæœ
- âœ… å®Œå…¨ä¸€è‡´: 18/20 (90.0%)
- âš ï¸ è¼•å¾®å·®ç•°: 2/20 (10.0%)
- âŒ åš´é‡å·®ç•°: 0/20 (0.0%)

**æ¯”å°æº–ç¢ºåº¦**: 90.0%

---

## ğŸ“Œ å»ºè­°èˆ‡æ”¹é€²

### ç«‹å³è™•ç†
- ç„¡éœ€ç«‹å³è™•ç†çš„å•é¡Œ

### æœªä¾†æ”¹é€²
1. èª¿æ•´åƒ¹æ ¼ä¸Šé™è‡³ 20,000 ä»¥å®¹ç´é«˜åƒ¹è‚¡
2. è€ƒæ…®ç‚ºé«˜åƒ¹è‚¡è¨­å®šç¨ç«‹çš„é©—è­‰è¦å‰‡

---

## âœ… é©—è­‰çµè«–

**æœ€çµ‚è©•åˆ†**: A (95.0%)
**é©—è­‰ç‹€æ…‹**: âœ… PASS
**è³‡æ–™å“è³ª**: å„ªè‰¯

æœ¬æ¬¡é©—è­‰ç™¼ç¾ 2 ç­†æ•¸å€¼è¶…å‡ºé æœŸç¯„åœï¼Œä½†å±¬æ–¼é«˜åƒ¹è‚¡æ­£å¸¸ç¾è±¡ï¼Œä¸å½±éŸ¿è³‡æ–™æ­£ç¢ºæ€§ã€‚è³‡æ–™å®Œæ•´æ€§èˆ‡é‚è¼¯ä¸€è‡´æ€§å‡é€šéé©—è­‰ï¼Œå¯å®‰å…¨ä½¿ç”¨ã€‚

---

**é©—è­‰ç¨‹å¼ç‰ˆæœ¬**: 1.0.0
**é©—è­‰è€…**: tw-stock-collector automated validation
```

### å ±å‘Šç”Ÿæˆè¦å‰‡

#### 1. è‡ªå‹•ç”Ÿæˆæ™‚æ©Ÿ
- âœ… æ¯æ—¥è³‡æ–™æ”¶é›†å®Œæˆå¾Œ
- âœ… æ­·å²è³‡æ–™å›è£œå®Œæˆå¾Œ
- âœ… æ‰‹å‹•åŸ·è¡Œé©—è­‰è…³æœ¬

#### 2. å ±å‘Šå„²å­˜ä½ç½®
- èˆ‡è³‡æ–™æª”æ¡ˆåŒç›®éŒ„: `data/raw/{type}/{YYYY}/{MM}/`
- æª”æ¡ˆå‘½å: `{YYYY-MM-DD}-report.md`
- ä¿ç•™æ‰€æœ‰æ­·å²å ±å‘Š

#### 3. è©•åˆ†æ¨™æº–

| è©•åˆ† | æº–ç¢ºç‡ | èªªæ˜ |
|------|--------|------|
| A+ | 99.5%+ | å®Œç¾ï¼Œç„¡ä»»ä½•å•é¡Œ |
| A | 95.0%+ | å„ªè‰¯ï¼Œåƒ…æœ‰è¼•å¾®è­¦å‘Š |
| B | 90.0%+ | è‰¯å¥½ï¼Œæœ‰å°‘é‡è­¦å‘Š |
| C | 85.0%+ | åˆæ ¼ï¼Œæœ‰è¼ƒå¤šè­¦å‘Š |
| D | 80.0%+ | å‹‰å¼·åˆæ ¼ï¼Œéœ€è¦é—œæ³¨ |
| F | < 80.0% | ä¸åˆæ ¼ï¼Œéœ€è¦ä¿®æ­£ |

#### 4. é©—è­‰ç‹€æ…‹å®šç¾©

- âœ… **PASS**: å®Œå…¨é€šéé©—è­‰
- âš ï¸ **WARN**: é€šéä½†æœ‰è­¦å‘Šï¼ˆä¸å½±éŸ¿ä½¿ç”¨ï¼‰
- âŒ **FAIL**: æœªé€šéé©—è­‰ï¼ˆéœ€è¦ä¿®æ­£ï¼‰

---

**æœ€å¾Œæ›´æ–°**: 2025-12-28
**ç¶­è­·è€…**: tw-stock-collector å°ˆæ¡ˆåœ˜éšŠ
